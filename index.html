<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vynix AI - Official Data Contribution Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .glass { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); }
  </style>
</head>
<body class="text-white">
  <div class="max-w-5xl mx-auto p-8">
    <!-- Header -->
    <div class="text-center py-16">
      <h1 class="text-6xl font-black mb-4 bg-gradient-to-r from-pink-300 to-purple-300 bg-clip-text text-transparent">
        Vynix AI Official Dashboard
      </h1>
      <p class="text-2xl opacity-90">The only place to feed the global pure-matching brain</p>
      <p class="text-xl mt-4 opacity-80">Duplicate triggers are automatically blocked • One perfect response per phrase</p>
    </div>

    <!-- Add Single -->
    <div class="glass rounded-3xl p-12 mb-10 shadow-2xl">
      <h2 class="text-4xl font-bold mb-10 text-center">Add One Perfect Response</h2>
      <div class="grid md:grid-cols-2 gap-10 mb-10">
        <div>
          <label class="text-lg font-semibold block mb-4 opacity-90">Trigger Phrase</label>
          <input id="trigger" type="text" placeholder='e.g. "hello", "how are you", "good night"' class="w-full p-6 bg-white/20 rounded-2xl text-xl placeholder-white/50 focus:outline-none focus:ring-4 focus:ring-pink-500/50" autocomplete="off">
          <p id="trigger-warning" class="mt-3 text-red-400 font-bold text-lg hidden">⚠️ This trigger already exists!</p>
        </div>
        <div>
          <label class="text-lg font-semibold block mb-4 opacity-90">Bot Reply</label>
          <input id="reply" type="text" placeholder="Exactly what Vynix should say" class="w-full p-6 bg-white/20 rounded-2xl text-xl placeholder-white/50 focus:outline-none focus:ring-4 focus:ring-pink-500/50" autocomplete="off">
        </div>
      </div>
      <div class="text-center">
        <button id="add-single" disabled class="px-16 py-6 bg-gray-600 text-white/70 font-bold text-2xl rounded-2xl cursor-not-allowed transition shadow-xl">
          Checking for duplicates...
        </button>
      </div>
    </div>

    <!-- Bulk Import -->
    <div class="glass rounded-3xl p-12 mb-10 shadow-2xl">
      <h2 class="text-4xl font-bold mb-10 text-center">Bulk Import (JSON)</h2>
      <textarea id="bulk-json" class="w-full p-8 bg-white/10 rounded-2xl font-mono text-lg placeholder-white/40 h-80" placeholder='[
  {"trigger":"hi","reply":"Hey there!"},
  {"trigger":"thanks","reply":"You are very welcome!"}
]'></textarea>
      <div class="text-center mt-8">
        <button id="bulk-import" class="px-12 py-5 bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold text-xl rounded-2xl hover:scale-105 transition shadow-xl">
          Import All (Duplicates Skipped)
        </button>
      </div>
      <div id="bulk-status" class="text-center mt-6 text-2xl font-bold"></div>
    </div>

    <!-- Your Contributions -->
    <div class="glass rounded-3xl p-12 shadow-2xl">
      <div class="flex justify-between items-center mb-10">
        <h2 class="text-4xl font-bold">Your Contributions</h2>
        <div class="text-right">
          <div class="text-2xl opacity-80">You have added</div>
          <div class="text-5xl font-black text-pink-400" id="my-count">0</div>
        </div>
      </div>
      <div id="my-pairs" class="space-y-6 max-h-screen overflow-y-auto"></div>
    </div>

    <!-- Global Stats -->
    <div class="text-center mt-16 text-xl opacity-80">
      <p>Global Brain Size: <span id="total-count" class="font-bold text-3xl text-pink-400">Loading...</span> unique responses</p>
      <p class="mt-4">Thank you for keeping Vynix perfect ❤️</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getDatabase, ref, push, set, onValue, remove, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const el = {
      trigger: document.getElementById('trigger'),
      reply: document.getElementById('reply'),
      addSingle: document.getElementById('add-single'),
      triggerWarning: document.getElementById('trigger-warning'),
      bulkJson: document.getElementById('bulk-json'),
      bulkImport: document.getElementById('bulk-import'),
      bulkStatus: document.getElementById('bulk-status'),
      myPairs: document.getElementById('my-pairs'),
      myCount: document.getElementById('my-count'),
      totalCount: document.getElementById('total-count')
    };

    let myUid = null;
    let existingTriggers = new Set(); // For instant duplicate check

    // Load all triggers into memory for instant validation
    onValue(ref(db, 'pairs'), (snap) => {
      const data = snap.val() || {};
      existingTriggers = new Set();
      let total = 0;
      let mine = 0;

      Object.values(data).forEach(p => {
        if (p.trigger) {
          existingTriggers.add(p.trigger.toLowerCase().trim());
          total++;
          if (p.uid === myUid) mine++;
        }
      });

      el.totalCount.textContent = total.toLocaleString();
      el.myCount.textContent = mine;

      // Re-check current input
      checkDuplicate();
    });

    // Real-time duplicate check as user types
    el.trigger.addEventListener('input', checkDuplicate);

    async function checkDuplicate() {
      const val = el.trigger.value.trim().toLowerCase();
      const exists = val && existingTriggers.has(val);

      if (exists) {
        el.triggerWarning.classList.remove('hidden');
        el.addSingle.disabled = true;
        el.addSingle.className = "px-16 py-6 bg-red-600/70 text-white/70 font-bold text-2xl rounded-2xl cursor-not-allowed";
        el.addSingle.textContent = "Duplicate Trigger!";
      } else if (val && el.reply.value.trim()) {
        el.triggerWarning.classList.add('hidden');
        el.addSingle.disabled = false;
        el.addSingle.className = "px-16 py-6 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold text-2xl rounded-2xl hover:scale-105 transition shadow-xl";
        el.addSingle.textContent = "Add to Global Brain";
      } else {
        el.addSingle.disabled = true;
        el.addSingle.className = "px-16 py-6 bg-gray-600 text-white/70 font-bold text-2xl rounded-2xl cursor-not-allowed";
        el.addSingle.textContent = "Fill both fields";
      }
    }

    el.reply.addEventListener('input', checkDuplicate);

    // Add single
    el.addSingle.onclick = async () => {
      if (el.addSingle.disabled) return;

      const trigger = el.trigger.value.trim();
      const reply = el.reply.value.trim();

      const newRef = push(ref(db, 'pairs'));
      await set(newRef, {
        trigger: trigger.toLowerCase(),
        reply,
        uid: auth.currentUser.uid,
        email: auth.currentUser.email || "Anonymous",
        addedAt: Date.now()
      });

      el.trigger.value = el.reply.value = '';
      checkDuplicate();
      alert("❤️ Added successfully! Live worldwide instantly.");
    };

    // Bulk import with duplicate skipping
    el.bulkImport.onclick = async () => {
      try {
        const items = JSON.parse(el.bulkJson.value);
        if (!Array.isArray(items)) throw "Not an array";

        let added = 0;
        let skipped = 0;

        for (const item of items) {
          const trigger = String(item.trigger || item.input || "").trim().toLowerCase();
          const reply = String(item.reply || item.output || "").trim();

          if (trigger && reply && !existingTriggers.has(trigger)) {
            const newRef = push(ref(db, 'pairs'));
            await set(newRef, {
              trigger,
              reply,
              uid: auth.currentUser.uid,
              addedAt: Date.now()
            });
            added++;
            existingTriggers.add(trigger); // Prevent double-add in same session
          } else if (trigger) {
            skipped++;
          }
        }

        el.bulkJson.value = '';
        el.bulkStatus.textContent = added > 0 
          ? `✓ Added ${added} new responses! (${skipped} duplicates skipped)`
          : "No new responses (all were duplicates)";
        el.bulkStatus.className = "text-green-400";
      } catch (e) {
        el.bulkStatus.textContent = "Invalid JSON format";
        el.bulkStatus.className = "text-red-400";
      }
    };

    // Render my contributions
    onValue(ref(db, 'pairs'), (snap) => {
      const data = snap.val() || {};
      const mine = Object.entries(data)
        .filter(([id, p]) => p.uid === myUid)
        .map(([id, p]) => ({id, ...p}));

      el.myPairs.innerHTML = mine.map(p => `
        <div class="bg-white/10 rounded-2xl p-8 backdrop-blur hover:bg-white/20 transition">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="text-pink-300 font-bold text-2xl mb-3">"${p.trigger}"</div>
              <div class="text-xl opacity-90">→ ${p.reply}</div>
            </div>
            <button onclick="deletePair('${p.id}')" class="ml-8 px-8 py-4 bg-red-600/80 rounded-xl hover:bg-red-600 font-bold">
              Delete
            </button>
          </div>
        </div>
      `).join('') || '<p class="text-center text-2xl opacity-50 py-20">No contributions yet — add your first one above!</p>';
    });

    window.deletePair = async (id) => {
      if (confirm("Permanently delete this response from the global brain?")) {
        await remove(ref(db, `pairs/${id}`));
      }
    };

    onAuthStateChanged(auth, user => {
      if (user) myUid = user.uid;
      else signInAnonymously(auth);
    });
  </script>
</body>
</html>
